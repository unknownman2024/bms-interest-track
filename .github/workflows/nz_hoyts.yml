name: Newzealand HOYTS BoxOffice Tracker

permissions:
  contents: write        # allows pushing code/files
  workflows: write       # allows updating workflows if needed

on:
  schedule:
    - cron: "30 */2 * * *"   # every 2 hours at minute 30
  workflow_dispatch:      # allows manual run

jobs:
  run-tracker:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Setup Python
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Step 3: Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Step 4: Run the tracker script
      - name: Run HOYTS tracker
        run: |
          echo "‚è± Running Newzealand HOYTS tracker..."
          python nz_hoyts.py
          echo "‚úÖ Tracker finished."

      # Step 5: Commit & push updates
      - name: Commit & Push JSON data
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          echo "üîç Checking for changes in Newzealand Data..."
          git add "Newzealand Data/*.json"

          if git diff --cached --quiet; then
            echo "‚ÑπÔ∏è No changes detected, nothing to commit."
          else
            echo "üíæ Changes detected, committing..."
            git commit -m "üîÑ Update data $(date -u +"%Y-%m-%d %H:%M:%S")"
            echo "üöÄ Pushing updates to main branch..."
            git push origin main --force
            echo "‚úÖ Push complete."
          fi
